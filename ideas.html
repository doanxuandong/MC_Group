<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MC - Ideas</title>
    <link rel="stylesheet" href="ideas.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Major+Mono+Display" rel="stylesheet">
    <link href="assets/css/boxicons.min.css" rel="stylesheet">

    <!-- Styles -->
    <link href="assets/css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/components.css" rel="stylesheet">
    <link href="assets/css/media.css" rel="stylesheet">
    <link href="assets/css/chat.css" rel="stylesheet">
    <link href="https://vjs.zencdn.net/7.4.1/video-js.css" rel="stylesheet">
    <script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js" type="text/javascript"></script>
    <script src="assets/js/load.js" type="text/javascript"></script>
</head>
<body>
    <header>
        <img src=".\src\mc_white.png" alt="MC Group Logo" class="logo">
        <div class="header-container">
            <div class="icon-container">
              <a href="index.html"><i class="fa-solid fa-house header-icon"></i></a>
              <span class="icon-text">Home</span>
            </div>
            <div class="icon-container">
              <a href="ideas.html"><i class="fa-solid fa-lightbulb header-icon"></i></a>
              <span class="icon-text">Ideas</span>
            </div>
            <div class="icon-container">
              <a href="ranking.html"><i class="fa-solid fa-ranking-star top-logo"></i></a>
              <span class="top-logo-text">RANKING</span>
            </div>
            <div class="icon-container">
              <a href="inside.html"><i class="fa-solid fa-envelope header-icon"></i></a>
              <span class="icon-text">Inside</span>
            </div>
            <div class="icon-container">
              <a href="news.html">
                <i class="fa-solid fa-newspaper header-icon"></i>
              </a>
              <span class="icon-text">News</span>
            </div>
        </div>
    </header>

    <main style="margin-top:90px;max-width:700px;width:100%;margin-left:auto;margin-right:auto;">
        <section>
            <!-- Ô nhập nhỏ để mở modal -->
            <div id="openPostModal" class="fb-mini-input">
                <img src="./src/tom.jpg" alt="avatar" class="fb-avatar">
                <div class="fb-mini-placeholder">MCers, bạn đang nghĩ gì thế?</div>
            </div>
            <!-- Modal đăng bài -->
            <div id="postModal" class="fb-modal">
                <div class="fb-modal-content">
                    <div class="fb-modal-header">
                        <span class="fb-modal-title">Tạo bài viết</span>
                        <span class="fb-modal-close" id="closePostModal">&times;</span>
                    </div>
                    <div class="fb-modal-user">
                        <div style="position:relative;display:flex;align-items:center;justify-content:center;">
                            <img id="selectedAvatar" src="./src/tom.jpg" alt="avatar" class="fb-avatar" style="cursor:pointer;border:2px solid #6699ff;">
                            <input type="file" id="avatarUpload" accept="image/*" style="display:none;">
                            <div id="avatarMenu" style="display:none;position:absolute;top:50px;left:0;background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.18);padding:10px;z-index:10;">
                                <div style="display:flex;gap:10px;">
                                    <img src="./src/tom.jpg" class="avatar-option" style="width:40px;height:40px;border-radius:50%;cursor:pointer;">
                                    <img src="./src/sa.jpg" class="avatar-option" style="width:40px;height:40px;border-radius:50%;cursor:pointer;">
                                    <img src="./src/lu.jpg" class="avatar-option" style="width:40px;height:40px;border-radius:50%;cursor:pointer;">
                                    <img src="./src/one.jpg" class="avatar-option" style="width:40px;height:40px;border-radius:50%;cursor:pointer;">
                                    <img src="./src/mcblue.jpg" class="avatar-option" style="width:40px;height:40px;border-radius:50%;cursor:pointer;">
                                    <button id="uploadAvatarBtn" style="border:none;background:none;cursor:pointer;font-size:24px;" title="Tải ảnh lên"><i class="fa-solid fa-upload"></i></button>
                                </div>
                            </div>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:8px;flex:1;">
                            <input type="text" id="posterName" class="fb-modal-input" placeholder="Nhập họ tên..." required style="margin-bottom:4px;">
                            <select id="department" class="fb-modal-input" required>
                                <option value="" disabled selected>Chọn phòng ban...</option>
                                <option value="it">Phòng IT</option>
                                <option value="hr">Phòng Nhân sự</option>
                                <option value="marketing">Phòng Marketing</option>
                                <option value="sales">Phòng Kinh doanh</option>
                                <option value="airforce">Phòng không không quân</option>
                            </select>
                        </div>
                    </div>
                    <form id="confessionFormModal" class="fb-form-main">
                        <textarea id="postContentModal" rows="3" placeholder="MCers ơi, bạn đang nghĩ gì thế?" class="fb-textarea"></textarea>
                        <div id="imagePreviewContainer" style="width:100%;display:none;flex-direction:column;align-items:flex-start;margin:10px 0 0 0;">
                            <div style="position:relative;display:inline-block;width:90%;margin-left:auto;margin-right:auto;">
                                <img id="imagePreview" src="" alt="Preview" style="max-width:100%;max-height:220px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.12);display:block;width:100%;">
                                <button type="button" id="removeImageBtn" style="position:absolute;top:4px;right:4px;background:#fff;border:none;border-radius:50%;width:28px;height:28px;box-shadow:0 1px 4px rgba(0,0,0,0.18);font-size:18px;cursor:pointer;">&times;</button>
                            </div>
                        </div>
                        <div class="fb-modal-actions">
                            <label class="fb-action-btn">
                                <i class="fa-solid fa-image" style="color:#45bd62;"></i> Ảnh/video
                                <input type="file" id="postImageModal" accept="image/*" style="display:none;">
                            </label>
                            <label class="fb-action-btn">
                                <i class="fa-regular fa-face-smile" style="color:#f7b928;"></i> Cảm xúc
                            </label>
                            <label class="fb-action-btn">
                                <i class="fa-solid fa-location-dot" style="color:#f5533d;"></i> Địa điểm
                            </label>
                        </div>
                        <button type="submit" class="fb-submit-btn" style="margin-top:10px;">Đăng</button>
                    </form>
                </div>
            </div>
            <section id="feed">
                <!-- Các bài đăng sẽ xuất hiện ở đây -->
            </section>
        </section>
    </main>

    <div class="back-to-top">
        <i class="fa-solid fa-arrow-up"></i>
    </div>

    <script>
        //Nút Back to Top
        const backToTop = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 100) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        });

        backToTop.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Modal logic
        const openPostModal = document.getElementById('openPostModal');
        const postModal = document.getElementById('postModal');
        const closePostModal = document.getElementById('closePostModal');
        openPostModal.addEventListener('click', () => {
            postModal.classList.add('show');
        });
        closePostModal.addEventListener('click', () => {
            postModal.classList.remove('show');
        });
        window.addEventListener('click', (e) => {
            if (e.target === postModal) {
                postModal.classList.remove('show');
            }
        });

        // Confession Feed Logic (modal version)
        const confessionFormModal = document.getElementById('confessionFormModal');
        const postContentModal = document.getElementById('postContentModal');
        const postImageModal = document.getElementById('postImageModal');
        const feed = document.getElementById('feed');
        const posterName = document.getElementById('posterName');
        const department = document.getElementById('department');
        const submitBtn = confessionFormModal.querySelector('.fb-submit-btn');

        function validateForm() {
            const nameValid = posterName.value.trim().length > 0;
            const deptValid = department.value && department.value !== '';
            submitBtn.disabled = !(nameValid && deptValid);
            submitBtn.style.opacity = submitBtn.disabled ? 0.6 : 1;
            submitBtn.style.cursor = submitBtn.disabled ? 'not-allowed' : 'pointer';
        }
        posterName.addEventListener('input', validateForm);
        department.addEventListener('change', validateForm);
        validateForm();

        // Avatar chọn/upload logic
        let currentAvatar = './src/tom.jpg';
        const selectedAvatar = document.getElementById('selectedAvatar');
        const avatarMenu = document.getElementById('avatarMenu');
        const avatarOptions = () => document.querySelectorAll('.avatar-option');
        const avatarUpload = document.getElementById('avatarUpload');
        const uploadAvatarBtn = document.getElementById('uploadAvatarBtn');
        const avatarToast = document.getElementById('avatarToast');

        selectedAvatar.addEventListener('click', () => {
            avatarMenu.style.display = avatarMenu.style.display === 'block' ? 'none' : 'block';
        });
        document.addEventListener('click', (e) => {
            if (!selectedAvatar.contains(e.target) && !avatarMenu.contains(e.target)) {
                avatarMenu.style.display = 'none';
            }
        });
        function setAvatar(src) {
            currentAvatar = src;
            selectedAvatar.src = src;
            avatarMenu.style.display = 'none';
        }
        setTimeout(() => {
            avatarOptions().forEach(img => {
                img.addEventListener('click', () => setAvatar(img.src));
            });
        }, 500);
        uploadAvatarBtn.addEventListener('click', () => {
            avatarUpload.click();
        });
        avatarUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    setAvatar(evt.target.result);
                    // Hiển thị thông báo
                    avatarToast.style.display = 'block';
                    setTimeout(() => { avatarToast.style.display = 'none'; }, 2500);
                };
                reader.readAsDataURL(file);
            }
        });

        // Preview ảnh khi chọn ảnh bài đăng
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageBtn = document.getElementById('removeImageBtn');
        postImageModal.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(evt) {
                    imagePreview.src = evt.target.result;
                    imagePreviewContainer.style.display = 'flex';
                };
                reader.readAsDataURL(file);
            } else {
                imagePreviewContainer.style.display = 'none';
                imagePreview.src = '';
            }
        });
        removeImageBtn.addEventListener('click', function() {
            postImageModal.value = '';
            imagePreviewContainer.style.display = 'none';
            imagePreview.src = '';
        });

        function createPost(content, imageUrl, name, dept, avatarUrl) {
            const post = document.createElement('div');
            post.className = 'confession-post';
            post.style = 'background:#fff;padding:18px 16px 12px 16px;border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,0.06);margin-bottom:24px;';
            post.innerHTML = `
                <div style="display:flex;align-items:center;margin-bottom:10px;">
                    <img src='${avatarUrl}' alt='avatar' style='width:40px;height:40px;border-radius:50%;object-fit:cover;margin-right:10px;border:2px solid #6699ff;'>
                    <div style='display:flex;flex-direction:column;'>
                        <span style='font-weight:600;font-size:16px;color:#222;'>${name} - ${dept}</span>
                        <span class='post-time' style='font-size:12px;color:#888;'>Vừa xong</span>
                    </div>
                </div>
                <div style="font-size:16px;color:#222;white-space:pre-line;">${content}</div>
                ${imageUrl ? `<img src="${imageUrl}" style="max-width:100%;margin:12px 0;border-radius:8px;">` : ''}
                <div class="reactions" style="margin-top:8px;">
                    <button class="react-btn" data-type="like" style="background:none;border:none;cursor:pointer;font-size:18px;margin-right:10px;">👍 <span>0</span></button>
                    <button class="react-btn" data-type="love" style="background:none;border:none;cursor:pointer;font-size:18px;margin-right:10px;">❤️ <span>0</span></button>
                    <button class="react-btn" data-type="haha" style="background:none;border:none;cursor:pointer;font-size:18px;">😂 <span>0</span></button>
                </div>
                <div class="comment-section" style="margin-top:10px;display:flex;align-items:center;gap:8px;width:100%;">
                    <textarea class="comment-input" placeholder="Viết bình luận..." rows="1" style="flex:1;padding:7px 10px;border-radius:6px;border:1px solid #ddd;font-size:15px;resize:none;overflow:auto;"></textarea>
                    <button class="comment-btn" style="background:#fff;border:none;padding:7px 10px;border-radius:50%;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#2374e1;transition:background 0.2s;"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
                <ul class="comments" style="list-style:none;padding-left:0;margin-top:10px;"></ul>
            `;
            // React logic
            post.querySelectorAll('.react-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const span = this.querySelector('span');
                    span.textContent = parseInt(span.textContent) + 1;
                });
            });
            // Comment logic
            const commentBtn = post.querySelector('.comment-btn');
            const commentInput = post.querySelector('.comment-input');
            const commentsList = post.querySelector('.comments');
            commentInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            commentInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.ctrlKey) {
                    return;
                }
                if (e.key === 'Enter' && e.ctrlKey) {
                    e.preventDefault();
                    commentBtn.click();
                }
            });
            commentBtn.addEventListener('click', function() {
                if (commentInput.value.trim()) {
                    const li = document.createElement('li');
                    li.className = 'comment-item';
                    li.textContent = commentInput.value;
                    // Thêm actions like/dislike
                    const actions = document.createElement('div');
                    actions.className = 'comment-actions';
                    actions.innerHTML = `
                        <button class="comment-like-btn" title="Like"><i class="fa-solid fa-thumbs-up"></i> <span class="like-count">0</span></button>
                        <button class="comment-dislike-btn" title="Dislike"><i class="fa-solid fa-thumbs-down"></i> <span class="dislike-count">0</span></button>
                    `;
                    li.appendChild(actions);
                    commentsList.appendChild(li);
                    commentInput.value = '';
                    commentInput.style.height = '36px';
                    // Like/Dislike logic
                    const likeBtn = actions.querySelector('.comment-like-btn');
                    const dislikeBtn = actions.querySelector('.comment-dislike-btn');
                    const likeCount = actions.querySelector('.like-count');
                    const dislikeCount = actions.querySelector('.dislike-count');
                    likeBtn.addEventListener('click', function() {
                        likeCount.textContent = parseInt(likeCount.textContent) + 1;
                    });
                    dislikeBtn.addEventListener('click', function() {
                        dislikeCount.textContent = parseInt(dislikeCount.textContent) + 1;
                    });
                }
            });
            feed.prepend(post);
        }

        confessionFormModal.addEventListener('submit', function(e) {
            e.preventDefault();
            const content = postContentModal.value.trim();
            const file = postImageModal && postImageModal.files[0];
            const name = posterName.value.trim();
            const deptValue = department.value;
            const dept = deptValue ? department.options[department.selectedIndex].text : '';
            const avatarUrl = currentAvatar;
            if (!name || !deptValue) {
                alert('Vui lòng nhập họ tên và chọn phòng ban!');
                return;
            }
            if (!content && !file) return;
            if (file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    createPost(content, evt.target.result, name, dept, avatarUrl);
                };
                reader.readAsDataURL(file);
            } else {
                createPost(content, null, name, dept, avatarUrl);
            }
            postContentModal.value = '';
            if (postImageModal) postImageModal.value = '';
            imagePreviewContainer.style.display = 'none';
            imagePreview.src = '';
            posterName.value = '';
            department.value = '';
            validateForm();
            postModal.classList.remove('show');
        });
    </script>
    <div id="avatarToast" style="display:none;position:fixed;bottom:40px;left:50%;transform:translateX(-50%);background:#242526;color:#fff;padding:14px 28px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.18);font-size:16px;z-index:3000;">Đã tải ảnh lên thành công!</div>
</body>
</html>