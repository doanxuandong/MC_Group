<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Quản trị hệ thống MC Group</title>
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
    /* Modal custom cho thêm tin tức */
    #addNewsModal.modal-bxh {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.25);
      align-items: center;
      justify-content: center;
    }
    #addNewsModal[style*="display: flex"] {
      display: flex !important;
    }
    #addNewsModal .modal-bxh-content {
      background: #fff;
      border-radius: 18px;
      max-width: 420px;
      width: 96vw;
      padding: 32px 24px 24px 24px;
      position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 14px;
      animation: modalFadeIn 0.25s;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: none; }
    }
    #addNewsModal .modal-title {
      text-align: center;
      color: #1976d2;
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 10px;
    }
    #addNewsModal .modal-close-btn {
      position: absolute;
      top: 16px; right: 18px;
      background: none;
      border: none;
      font-size: 1.3rem;
      color: #1976d2;
      cursor: pointer;
      transition: color 0.18s;
    }
    #addNewsModal .modal-close-btn:hover {
      color: #d32f2f;
    }
    #addNewsModal form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    #addNewsModal input[type="text"],
    #addNewsModal select,
    #addNewsModal textarea {
      border: 1.5px solid #e3eaf2;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 1rem;
      outline: none;
      transition: border 0.18s;
      background: #f8fafc;
      color: #222;
    }
    #addNewsModal input[type="text"]:focus,
    #addNewsModal select:focus,
    #addNewsModal textarea:focus {
      border: 1.5px solid #1976d2;
      background: #fff;
    }
    #addNewsModal textarea {
      min-height: 60px;
      resize: vertical;
    }
    #addNewsModal .add-btn {
      display: block;
      width: 100%;
      background: linear-gradient(90deg, #1976d2 60%, #42a5f5 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 0;
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 8px;
      cursor: pointer;
      transition: background 0.18s, transform 0.18s;
      text-align: center;
    }
    #addNewsModal .add-btn span {
      display: inline-block;
      width: 100%;
      text-align: center;
    }
    #addNewsModal .add-btn:hover {
      background: #1565c0;
      transform: translateY(-2px);
    }
    #addNewsModal .custom-upload {
      margin-top: 2px;
      margin-bottom: 2px;
    }
    #addNewsModal .custom-upload-label {
      display: block;
      width: 100%;
      border: 1.5px dashed #b0bec5;
      border-radius: 8px;
      padding: 10px 14px;
      color: #1976d2;
      background: #f1f6fb;
      cursor: pointer;
      font-size: 1rem;
      transition: border 0.18s, background 0.18s;
      box-sizing: border-box;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    #addNewsModal .custom-upload-label:hover {
      border-color: #1976d2;
      background: #e3f2fd;
    }
    #addNewsModal #news-preview img {
      margin-top: 8px;
      max-width: 100%;
      max-height: 180px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(25,118,210,0.08);
    }
    .notification.success {
      position: fixed;
      top: 24px;
      right: 32px;
      z-index: 99999;
      background: #43a047;
      color: #fff;
      padding: 16px 32px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      box-shadow: 0 4px 16px rgba(67,160,71,0.18);
      animation: fadeInRight 0.4s;
      display: flex;
      align-items: center;
      min-width: 220px;
      justify-content: center;
    }
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(60px); }
      to { opacity: 1; transform: none; }
    }
    #confirmDeleteModal .modal-content {
        padding: 32px 24px 24px 24px !important;
        min-height: unset !important;
        height: auto !important;
        display: block !important;
        box-sizing: border-box;
    }
    #confirmDeleteModal .modal-content > div {
        margin-bottom: 0 !important;
    }
    .modal-confirm-delete .modal-content {
        padding: 32px 24px 24px 24px !important;
        min-height: unset !important;
        height: auto !important;
        display: block !important;
        box-sizing: border-box;
        align-items: unset !important;
        flex-direction: unset !important;
        gap: 0 !important;
    }
    .modal-confirm-delete .modal-content > div {
        margin-bottom: 0 !important;
    }
    .notification.error {
      position: fixed;
      top: 24px;
      right: 32px;
      z-index: 99999;
      background: #d32f2f;
      color: #fff;
      padding: 16px 32px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      box-shadow: 0 4px 16px rgba(211,47,47,0.18);
      animation: fadeInRight 0.4s;
      display: flex;
      align-items: center;
      min-width: 220px;
      justify-content: center;
    }
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(60px); }
      to { opacity: 1; transform: none; }
    }
    .pagination-btn {
        padding: 6px 12px;
        margin: 0 4px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .pagination-btn:hover:not(:disabled) {
        background: #f5f5f5;
    }
    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    </style>
</head>
<body>
    <div class="admin-container">
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <i class="fa-solid fa-user-shield"></i> MC Admin
            </div>
            <nav class="admin-menu">
                <ul>
                    <li class="active" data-section="posts"><i class="fa-solid fa-file-alt"></i> Quản lý bài viết</li>
                    <li data-section="users"><i class="fa-solid fa-users"></i> Quản lý tài khoản</li>
                    <li data-section="ranking"><i class="fa-solid fa-trophy"></i> Quản lý BXH</li>
                    <li data-section="mailbox"><i class="fa-solid fa-inbox"></i> Quản lý hòm thư</li>
                    <li data-section="news"><i class="fa-solid fa-newspaper"></i> Quản lý tin tức</li>
                    <li data-section="banner"><i class="fa-solid fa-image"></i> Quản lý banner</li>
                </ul>
            </nav>
        </aside>
        <main class="admin-main">
            <div class="admin-title-row">
                <h1 class="admin-title">Quản lý bài viết</h1>
                <button class="add-btn">+ Thêm</button>
            </div>
            <div class="admin-section" id="section-posts">
                <div class="admin-filter-bar">
                    <input type="text" class="admin-filter-input" placeholder="Tiêu đề...">
                    <input type="text" class="admin-filter-input" placeholder="Người đăng...">
                    <select class="admin-filter-select">
                        <option value="">Phòng ban</option>
                        <option value="ACC">ACC</option>
                        <option value="ACC IOB">ACC IOB</option>
                        <option value="AHR">AHR</option>
                        <option value="BOD">BOD</option>
                        <option value="DES">DES</option>
                        <option value="FIN">FIN</option>
                        <option value="IOB">IOB</option>
                        <option value="IOB DT">IOB DT</option>
                        <option value="ITS">ITS</option>
                        <option value="OPE">OPE</option>
                        <option value="OPE-HN">OPE-HN</option>
                        <option value="PCC">PCC</option>
                        <option value="PDH">PDH</option>
                        <option value="PLA">PLA</option>
                        <option value="SQC">SQC</option>
                        <option value="VPHN">VPHN</option>
                        <option value="WHR">WHR</option>
                    </select>
                    <input type="date" class="admin-filter-input" placeholder="Ngày...">
                    <button class="admin-filter-btn"><i class="fa-solid fa-filter"></i> Lọc</button>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr><th>ID</th><th>Tiêu đề</th><th>Người đăng</th><th>Phòng ban</th><th>Ngày đăng</th><th>Hành động</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>Bài viết mẫu 1</td><td>Nguyễn Văn A</td><td>Phòng IT</td><td>01/05/2024</td><td><button class="action-btn delete-btn"><i class="fa-solid fa-trash"></i></button><button class="action-btn edit-btn"><i class="fa-solid fa-pen"></i></button><button class="action-btn detail-btn"><i class="fa-solid fa-eye"></i></button></td></tr>
                        <tr><td>2</td><td>Bài viết mẫu 2</td><td>Trần Thị B</td><td>Phòng Marketing</td><td>02/05/2024</td><td><button class="action-btn delete-btn"><i class="fa-solid fa-trash"></i></button><button class="action-btn edit-btn"><i class="fa-solid fa-pen"></i></button><button class="action-btn detail-btn"><i class="fa-solid fa-eye"></i></button></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="admin-title-row" style="display:none;">
                <h1 class="admin-title">Quản lý tài khoản</h1>
                <button class="add-btn" id="addUserBtn" data-bs-toggle="modal" data-bs-target="#addUserModal">+ Thêm</button>
            </div>
            <div class="admin-section" id="section-users" style="display:none;">
                <div class="admin-filter-bar">
                    <input type="text" class="admin-filter-input" placeholder="Tìm theo tên...">
                    <select class="admin-filter-select">
                        <option value="">Phòng ban</option>
                        <option value="ACC">ACC</option>
                        <option value="ACC IOB">ACC IOB</option>
                        <option value="AHR">AHR</option>
                        <option value="BOD">BOD</option>
                        <option value="DES">DES</option>
                        <option value="FIN">FIN</option>
                        <option value="IOB">IOB</option>
                        <option value="IOB DT">IOB DT</option>
                        <option value="ITS">ITS</option>
                        <option value="OPE">OPE</option>
                        <option value="OPE-HN">OPE-HN</option>
                        <option value="PCC">PCC</option>
                        <option value="PDH">PDH</option>
                        <option value="PLA">PLA</option>
                        <option value="SQC">SQC</option>
                        <option value="VPHN">VPHN</option>
                        <option value="WHR">WHR</option>
                    </select>
                    <input type="email" class="admin-filter-input" placeholder="Email...">
                    <select class="admin-filter-select">
                        <option value="">Vai trò</option>
                        <option value="admin">Admin</option>
                        <option value="user">User</option>
                    </select>
                    <!-- <input type="date" class="admin-filter-input" placeholder="Ngày..."> -->
                    <button class="admin-filter-btn"><i class="fa-solid fa-filter"></i> Lọc</button>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr><th>ID</th><th>Tên người dùng</th><th>Phòng ban</th><th>Email</th><th>Mật khẩu</th><th>Ngày sinh</th><th>Vai trò</th><th>Hành động</th></tr>
                    </thead>
                    <tbody id="userTableBody">
                        <!-- Dữ liệu sẽ được render bằng JS -->
                    </tbody>
                </table>
                <div id="userPagination" style="margin: 18px 0; display: flex; gap: 8px;"></div>
            </div>
            <div class="admin-title-row" style="display:none;">
                <h1 class="admin-title">Quản lý bảng xếp hạng</h1>
                <button class="add-btn">+ Thêm</button>
            </div>
            <div class="admin-section" id="section-ranking" style="display:none;">
                <div class="admin-filter-bar">
                    <input type="text" class="admin-filter-input" placeholder="Tên bảng xếp hạng...">
                    <select class="admin-filter-select">
                        <option value="">Phòng ban</option>
                        <option value="ACC">ACC</option>
                        <option value="ACC IOB">ACC IOB</option>
                        <option value="AHR">AHR</option>
                        <option value="BOD">BOD</option>
                        <option value="DES">DES</option>
                        <option value="FIN">FIN</option>
                        <option value="IOB">IOB</option>
                        <option value="IOB DT">IOB DT</option>
                        <option value="ITS">ITS</option>
                        <option value="OPE">OPE</option>
                        <option value="OPE-HN">OPE-HN</option>
                        <option value="PCC">PCC</option>
                        <option value="PDH">PDH</option>
                        <option value="PLA">PLA</option>
                        <option value="SQC">SQC</option>
                        <option value="VPHN">VPHN</option>
                        <option value="WHR">WHR</option>
                    </select>
                    <select class="admin-filter-select">
                        <option value="">Hạng mục đề cử</option>
                        <option value="nvxuatxac">Nhân viên xuất sắc</option>
                        <option value="phongbanxuatxac">Phòng ban xuất sắc</option>
                        <option value="duanxuatxac">Dự án xuất sắc</option>
                    </select>
                    <select class="admin-filter-select">
                        <option value="">Tháng</option>
                        <option value="1">Tháng 1</option>
                        <option value="2">Tháng 2</option>
                        <option value="3">Tháng 3</option>
                        <option value="4">Tháng 4</option>
                        <option value="5">Tháng 5</option>
                        <option value="6">Tháng 6</option>
                        <option value="7">Tháng 7</option>
                        <option value="8">Tháng 8</option>
                        <option value="9">Tháng 9</option>
                        <option value="10">Tháng 10</option>
                        <option value="11">Tháng 11</option>
                        <option value="12">Tháng 12</option>
                    </select>
                    <select class="admin-filter-select">
                        <option value="">Năm</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                    <button class="admin-filter-btn"><i class="fa-solid fa-filter"></i> Lọc</button>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr><th>ID</th><th>Tên bảng xếp hạng</th><th>Phòng ban</th><th>Hạng mục đề cử</th><th>Tháng</th><th>Năm</th><th>Người tạo</th><th>Hành động</th></tr>
                    </thead>
                    <tbody id="rankingTableBody">
                        <!-- Dữ liệu sẽ được render bằng JS -->
                    </tbody>
                </table>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên</th>
                            <th>Phòng ban</th>
                            <th>Hạng mục đề cử</th>
                            <th>Tháng/Năm</th>
                            <th>Avatar</th>
                            <th>Vị thứ</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="rankingMembersTableBody">
                        <!-- Dữ liệu sẽ được render bằng JS -->
                    </tbody>
                </table>
            </div>
            <div class="admin-title-row" style="display:none;">
                <h1 class="admin-title">Quản lý hòm thư</h1>
                <button class="add-btn">+ Thêm</button>
            </div>
            <div class="admin-section" id="section-mailbox" style="display:none;">
                <div class="admin-filter-bar">
                    <input type="text" class="admin-filter-input" placeholder="Người gửi...">
                    <input type="tel" class="admin-filter-input" placeholder="Số điện thoại...">
                    <select class="admin-filter-select">
                        <option value="">Phòng ban</option>
                        <option value="ACC">ACC</option>
                        <option value="ACC IOB">ACC IOB</option>
                        <option value="AHR">AHR</option>
                        <option value="BOD">BOD</option>
                        <option value="DES">DES</option>
                        <option value="FIN">FIN</option>
                        <option value="IOB">IOB</option>
                        <option value="IOB DT">IOB DT</option>
                        <option value="ITS">ITS</option>
                        <option value="OPE">OPE</option>
                        <option value="OPE-HN">OPE-HN</option>
                        <option value="PCC">PCC</option>
                        <option value="PDH">PDH</option>
                        <option value="PLA">PLA</option>
                        <option value="SQC">SQC</option>
                        <option value="VPHN">VPHN</option>
                        <option value="WHR">WHR</option>
                    </select>
                    <select class="admin-filter-select">
                        <option value="">Loại ý kiến</option>
                        <option value="feedback">Góp ý</option>
                        <option value="complaint">Khiếu nại</option>
                        <option value="suggestion">Đề xuất</option>
                    </select>
                    <input type="date" class="admin-filter-input" placeholder="Ngày gửi...">
                    <button class="admin-filter-btn"><i class="fa-solid fa-filter"></i> Lọc</button>
                    <button class="admin-filter-btn" id="mailbox-refresh-btn" style="background:#e3eaf2;color:#1976d2;"><i class="fa-solid fa-rotate"></i> Làm mới</button>
                </div>
                <div class="table-scroll-x">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="min-width:160px;">Người gửi</th>
                                <th>Email</th>
                                <th>Số điện thoại</th>
                                <th>Phòng ban</th>
                                <th>Loại ý kiến</th>
                                <th>Chi tiết ý kiến</th>
                                <th>Tệp đính kèm</th>
                                <th>Ngày gửi</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dữ liệu sẽ được render bằng JS -->
                        </tbody>
                    </table>
                </div>
                <div id="mailbox-pagination" style="display:flex;justify-content:center;align-items:center;gap:8px;margin:18px 0 0 0;"></div>
            </div>
            <div class="admin-title-row" style="display:none;">
                <h1 class="admin-title">Quản lý tin tức</h1>
                <button class="add-btn" id="add-news-btn">+ Thêm</button>
            </div>
            <div class="admin-section" id="section-news" style="display:none;">
                <div class="admin-filter-bar">
                    <input type="text" class="admin-filter-input" placeholder="Tiêu đề...">
                    <input type="text" class="admin-filter-input" placeholder="Người viết...">
                    <select class="admin-filter-select">
                        <option value="">Phòng ban</option>
                        <option value="ACC">ACC</option>
                        <option value="ACC IOB">ACC IOB</option>
                        <option value="AHR">AHR</option>
                        <option value="BOD">BOD</option>
                        <option value="DES">DES</option>
                        <option value="FIN">FIN</option>
                        <option value="IOB">IOB</option>
                        <option value="IOB DT">IOB DT</option>
                        <option value="ITS">ITS</option>
                        <option value="OPE">OPE</option>
                        <option value="OPE-HN">OPE-HN</option>
                        <option value="PCC">PCC</option>
                        <option value="PDH">PDH</option>
                        <option value="PLA">PLA</option>
                        <option value="SQC">SQC</option>
                        <option value="VPHN">VPHN</option>
                        <option value="WHR">WHR</option>
                    </select>
                    <input type="date" class="admin-filter-input" placeholder="Ngày...">
                    <button class="admin-filter-btn"><i class="fa-solid fa-filter"></i> Lọc</button>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr><th>ID</th><th>Tiêu đề tin tức</th><th>Người viết</th><th>Phòng ban</th><th>Ngày đăng</th><th>Hành động</th></tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được render bằng JS -->
                    </tbody>
                </table>
            </div>
            <div class="admin-title-row" style="display:none;">
                <h1 class="admin-title">Quản lý banner</h1>
                <button id="show-banner-form" class="add-btn">+ Thêm</button>
            </div>
            <div class="admin-section" id="section-banner" style="display:none;">
                <div class="admin-filter-bar">
                    <input type="text" class="admin-filter-input" placeholder="Tìm theo tiêu đề...">
                    <button class="admin-filter-btn"><i class="fa-solid fa-filter"></i> Lọc</button>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tiêu đề</th>
                            <th>Ảnh</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="banner-list">
                        <!-- hiển thị list banner -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
    <!-- Modal chi tiết BXH -->
    <div id="bxhDetailModal" class="modal-bxh" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
        <div class="modal-bxh-content" style="background:#fff;border-radius:14px;max-width:900px;width:96vw;max-height:90vh;overflow:auto;box-shadow:0 4px 24px rgba(0,0,0,0.18);padding:28px 18px 18px 18px;position:relative;">
            <button id="closeBxhModal" style="position:absolute;top:12px;right:18px;font-size:22px;background:none;border:none;cursor:pointer;color:#1976d2;"><i class="fa-solid fa-xmark"></i></button>
            <h2 style="text-align:center;color:#1976d2;margin-bottom:18px;">Chi tiết BXH Tháng/Năm</h2>
            <button id="addRankingMemberBtn" class="add-btn" style="margin-bottom:12px;">+ Thêm thành viên</button>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tên</th>
                        <th>Phòng ban</th>
                        <th>Hạng mục đề cử</th>
                        <th>Tháng/Năm</th>
                        <th>Avatar</th>
                        <th>Vị thứ</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody id="rankingMembersTableBody">
                    <!-- Dữ liệu sẽ được render bằng JS -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Export to Excel button, mỗi section một nút riêng -->
    <div class="export-excel-btn" id="export-excel-posts" style="display:none;"><i class="fa-solid fa-file-excel"></i> Xuất Excel</div>
    <div class="export-excel-btn" id="export-excel-ranking" style="display:none;"><i class="fa-solid fa-file-excel"></i> Xuất Excel</div>
    <div class="export-excel-btn" id="export-excel-mailbox" style="display:none;"><i class="fa-solid fa-file-excel"></i> Xuất Excel</div>
    <div class="export-excel-btn" id="export-excel-news" style="display:none;"><i class="fa-solid fa-file-excel"></i> Xuất Excel</div>
    <div class="export-excel-btn" id="export-excel-banner" style="display:none;"><i class="fa-solid fa-file-excel"></i> Xuất Excel</div>
    <!-- Modal Thêm Banner -->
    <div id="bannerModal" class="modal-bxh">
        <div class="modal-bxh-content">
            <button id="closeBannerModal"><i class="fa-solid fa-xmark"></i></button>
            <h2>Thêm Banner</h2>
            <form id="banner-form">
                <input type="text" id="banner-title" placeholder="Tiêu đề banner" required>
                <div id="drop-area" class="drop-area" style="padding:0;border:none;background:none;">
                  <input type="file" id="banner-image" accept="image/*" style="display:none;">
                  <label for="banner-image" id="drop-label" class="upload-banner-label">
                    <i class="fa fa-paperclip"></i> Kéo thả tệp tin của bạn ở đây hoặc chọn tệp tin.
                    <span id="file-upload-name"></span>
                  </label>
                  <div id="banner-preview"></div>
                </div>
                <button type="submit" class="add-btn">Thêm banner</button>
            </form>
        </div>
    </div>
    <!-- Modal xác nhận xóa -->
    <div id="delete-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Xác nhận xóa</h2>
            <p>Bạn có chắc chắn muốn xóa banner này?</p>
            <div class="modal-actions">
                <button class="cancel-btn" onclick="hideDeleteModal()">Hủy</button>
                <button class="delete-btn" onclick="confirmDelete()">Xóa</button>
            </div>
        </div>
    </div>
    <!-- Modal Sửa Banner -->
    <div id="editBannerModal" class="modal-bxh">
      <div class="modal-bxh-content">
        <button id="closeEditBannerModal"><i class="fa-solid fa-xmark"></i></button>
        <h2>Sửa Banner</h2>
        <form id="edit-banner-form">
          <input type="hidden" id="edit-banner-id">
          <input type="text" id="edit-banner-title" placeholder="Tiêu đề banner" required>
          <div id="edit-drop-area" class="drop-area">
            <input type="file" id="edit-banner-image" accept="image/*" style="display:none;">
            <label for="edit-banner-image" id="edit-drop-label" class="upload-banner-label">
              <i class="fa fa-paperclip"></i> Kéo thả tệp tin của bạn ở đây hoặc chọn tệp tin.
              <span id="edit-file-upload-name"></span>
            </label>
            <div id="edit-banner-preview"></div>
          </div>
          <button type="submit" class="add-btn">Lưu thay đổi</button>
        </form>
      </div>
    </div>

    <!-- Modal xem chi tiết góp ý -->
    <div id="feedbackDetailModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="document.getElementById('feedbackDetailModal').style.display='none'">&times;</span>
        <h2>Chi tiết ý kiến</h2>
        <div id="feedbackDetailContent"></div>
    </div>
    </div>
    <!-- Modal xác nhận xóa góp ý -->
    <div id="deleteFeedbackModal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center; font-weight:600; color:#222; margin-bottom:24px;">
            Bạn có chắc chắn muốn xóa ý kiến này?
            </h3>
            <div style="display: flex; gap: 18px; justify-content: center; align-items: center;">
            <button
                id="confirmDeleteFeedbackBtn"
                class="add-btn"
                style="
                flex: 1;
                font-size: 1.1rem;
                padding: 12px 0;
                display: flex;
                justify-content: center;
                align-items: center;
                "
            >
                Xóa
            </button>
            <button
                onclick="document.getElementById('deleteFeedbackModal').style.display='none';"
                class="add-btn"
                style="
                background: #ccc;
                color: #222;
                flex: 1;
                font-size: 1.1rem;
                padding: 12px 0;
                display: flex;
                justify-content: center;
                align-items: center;
                "
            >
                Hủy
            </button>
            </div>
        </div>
    </div>


    <!-- Modal thêm tin tức (Custom, không Bootstrap) -->
    <div id="addNewsModal" class="modal-bxh">
      <div class="modal-bxh-content">
        <button id="closeNewsModal" class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        <h2 class="modal-title">Thêm tin tức mới</h2>
        <form id="addNewsForm" autocomplete="off">
          <input type="text" id="newsTitle" name="title" placeholder="Tiêu đề tin tức" required>
          <input type="text" id="newsAuthor" name="author" placeholder="Người viết" required>
          <select id="newsDepartment" name="department" required>
            <option value="">Chọn phòng ban</option>
            <option value="ACC">ACC</option>
            <option value="ACC IOB">ACC IOB</option>
            <option value="AHR">AHR</option>
            <option value="BOD">BOD</option>
            <option value="DES">DES</option>
            <option value="FIN">FIN</option>
            <option value="IOB">IOB</option>
            <option value="IOB DT">IOB DT</option>
            <option value="ITS">ITS</option>
            <option value="OPE">OPE</option>
            <option value="OPE-HN">OPE-HN</option>
            <option value="PCC">PCC</option>
            <option value="PDH">PDH</option>
            <option value="PLA">PLA</option>
            <option value="SQC">SQC</option>
            <option value="VPHN">VPHN</option>
            <option value="WHR">WHR</option>
          </select>
          <select id="newsCategory" name="category" required>
            <option value="">Chọn danh mục</option>
            <option value="tin-noi-bo">Tin nội bộ</option>
            <option value="su-kien">Sự kiện</option>
            <option value="thong-bao">Thông báo</option>
            <option value="tuyen-dung">Tuyển dụng</option>
          </select>
          <textarea id="newsSummary" name="summary" rows="2" placeholder="Tóm tắt ngắn gọn" required></textarea>
          <textarea id="newsContent" name="content" rows="5" placeholder="Nội dung chi tiết" required></textarea>
          <div class="custom-upload">
            <input type="file" id="newsImage" name="image" accept="image/*" required hidden>
            <label for="newsImage" class="custom-upload-label">
              <i class="fa fa-paperclip"></i> Chọn hoặc kéo thả hình ảnh
              <span id="news-file-upload-name"></span>
            </label>
            <div id="news-preview"></div>
          </div>
          <button type="submit" id="saveNewsBtn" class="add-btn"><span>Thêm tin tức</span></button>
        </form>
      </div>
    </div>

    <!-- Modal xác nhận xóa dùng chung -->
    <div id="modalConfirmDelete" class="modal modal-confirm-delete">
      <div class="modal-content">
        <h3 id="modalConfirmDeleteQuestion" style="text-align:center; font-weight:600; color:#222; margin-bottom:24px;">
          Bạn có chắc chắn muốn xóa mục này?
        </h3>
        <div style="display: flex; gap: 18px; justify-content: center; align-items: center;">
          <button id="modalConfirmDeleteBtn" class="add-btn" style="flex:1; font-size:1.1rem; padding:12px 0; display:flex; justify-content:center; align-items:center;">Xóa</button>
          <button id="modalCancelDeleteBtn" class="add-btn" style="background:#ccc;color:#222; flex:1; font-size:1.1rem; padding:12px 0; display:flex; justify-content:center; align-items:center;">Hủy</button>
        </div>
      </div>
    </div>
    <script>
    // Biến lưu callback xóa động
    let currentDeleteCallback = null;
    let currentDeleteQuestion = 'Bạn có chắc chắn muốn xóa mục này?';

    function showConfirmDeleteModal(question, onDelete) {
      document.getElementById('modalConfirmDeleteQuestion').textContent = question || currentDeleteQuestion;
      document.getElementById('modalConfirmDelete').style.display = 'flex';
      currentDeleteCallback = onDelete;
    }
    document.getElementById('modalConfirmDeleteBtn').onclick = function() {
      if (typeof currentDeleteCallback === 'function') currentDeleteCallback();
      document.getElementById('modalConfirmDelete').style.display = 'none';
    };
    document.getElementById('modalCancelDeleteBtn').onclick = function() {
      document.getElementById('modalConfirmDelete').style.display = 'none';
      currentDeleteCallback = null;
    };
    window.addEventListener('click', function(e) {
      if (e.target === document.getElementById('modalConfirmDelete')) {
        document.getElementById('modalConfirmDelete').style.display = 'none';
        currentDeleteCallback = null;
      }
    });
    </script>

    <script>
    // Chuyển tab sidebar
    const titleRows = document.querySelectorAll('.admin-title-row');
    const sections = document.querySelectorAll('.admin-section');
    document.querySelectorAll('.admin-menu li').forEach((item, idx) => {
        item.onclick = function() {
            document.querySelectorAll('.admin-menu li').forEach(li => li.classList.remove('active'));
            this.classList.add('active');
            sections.forEach(sec => sec.style.display = 'none');
            titleRows.forEach(row => row.style.display = 'none');
            const section = this.getAttribute('data-section');
            document.getElementById('section-' + section).style.display = 'block';
            titleRows[idx].style.display = 'flex';
        }
    });
    // Mặc định hiển thị title-row đầu tiên
    if(titleRows.length) titleRows[0].style.display = 'flex';
    // Hiển thị modal chi tiết BXH khi bấm icon xem chi tiết
    const bxhDetailModal = document.getElementById('bxhDetailModal');
    document.querySelectorAll('#section-ranking .detail-btn').forEach(btn => {
        btn.onclick = function(e) {
            e.preventDefault();
            bxhDetailModal.style.display = 'flex';
        }
    });
    document.getElementById('closeBxhModal').onclick = function() {
        bxhDetailModal.style.display = 'none';
    };
    window.addEventListener('click', function(e) {
        if (e.target === bxhDetailModal) bxhDetailModal.style.display = 'none';
    });
    // Hiển thị nút export excel đúng với section đang mở
    function showExportBtn(section) {
        document.querySelectorAll('.export-excel-btn').forEach(btn => btn.style.display = 'none');
        if(section) {
            const btn = document.getElementById('export-excel-' + section);
            if(btn) btn.style.display = 'block';
        }
    }
    document.querySelectorAll('.admin-menu li').forEach(item => {
        item.addEventListener('click', function() {
            showExportBtn(this.getAttribute('data-section'));
        });
    });
    // Hiển thị mặc định cho mục đầu tiên
    showExportBtn(document.querySelector('.admin-menu li.active')?.getAttribute('data-section'));
    </script>


    <script>
    const API_URL = 'http://localhost:3000/api/banners';
    
    // Lấy danh sách banner và hiển thị
    async function fetchBanners() {
        const res = await fetch(API_URL);
        const banners = await res.json();
        const tbody = document.querySelector('#banner-list');
        tbody.innerHTML = '';
        banners.forEach((banner, idx) => {
            tbody.innerHTML += `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${banner.title}</td>
                    <td><img src="${banner.image_url}" style="max-width:100px"></td>
                    <td>
                        <button class="action-btn delete-btn" onclick="showDeleteModal(${banner.id})"><i class="fa-solid fa-trash"></i></button>
                        <button class="action-btn edit-btn" onclick="editBanner(${banner.id})"><i class="fa-solid fa-pen"></i></button>
                    </td>
                </tr>
            `;
        });
    }
    
    // Đưa các biến này ra phạm vi toàn cục để các hàm khác cùng dùng
    const fileNameSpan = document.getElementById('file-upload-name');
    const bannerPreview = document.getElementById('banner-preview');
    
    // Hiển thị modal thêm banner
    const showBannerFormBtn = document.getElementById('show-banner-form');
    const bannerModal = document.getElementById('bannerModal');
    const closeBannerModalBtn = document.getElementById('closeBannerModal');
    const bannerForm = document.getElementById('banner-form');
    if (showBannerFormBtn) {
        showBannerFormBtn.onclick = () => {
            bannerModal.style.display = 'flex';
        };
    }
    if (closeBannerModalBtn) {
        closeBannerModalBtn.onclick = () => {
            bannerModal.style.display = 'none';
            bannerForm.reset();
        };
    }
    window.addEventListener('click', function(e) {
        if (e.target === bannerModal) {
            bannerModal.style.display = 'none';
            bannerForm.reset();
        }
    });
    
    // Thêm banner mới (upload file)
    bannerForm.onsubmit = async function(e) {
        e.preventDefault();
        try {
            const title = document.getElementById('banner-title').value;
            const image = document.getElementById('banner-image').files[0];
            
            if (!title) {
                showNotification('Vui lòng nhập tiêu đề banner!', 'error');
                return;
            }
            
            if (!image) {
                showNotification('Vui lòng chọn ảnh banner!', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('image', image);

            const response = await fetch(API_URL, {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Thêm banner thất bại');
            }

            // Thêm thành công
            showNotification('Thêm banner thành công!', 'success');
            bannerModal.style.display = 'none';
            bannerForm.reset();
            if (fileNameSpan) fileNameSpan.innerHTML = '';
            if (bannerPreview) bannerPreview.innerHTML = '';
            await fetchBanners(); // Refresh danh sách banner
        } catch (error) {
            console.error('Error:', error);
            showNotification(error.message || 'Có lỗi xảy ra khi thêm banner', 'error');
        }
    };
    
    // Biến lưu ID banner cần xóa
    let bannerToDelete = null;

    // Hiển thị modal xác nhận xóa
    function showDeleteModal(id) {
        showConfirmDeleteModal('Bạn có chắc chắn muốn xóa banner này?', async function() {
            try {
                const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    fetchBanners();
                    showNotification('Xóa banner thành công!', 'success');
                } else {
                    throw new Error('Xóa banner thất bại');
                }
            } catch (error) {
                showNotification('Có lỗi xảy ra khi xóa banner', 'error');
            }
        });
    }

    // Ẩn modal xác nhận xóa
    function hideDeleteModal() {
        document.getElementById('delete-modal').style.display = 'none';
        bannerToDelete = null;
    }

    // Xác nhận xóa banner
    async function confirmDelete() {
        if (!bannerToDelete) return;
        
        try {
            const response = await fetch(`${API_URL}/${bannerToDelete}`, {
                method: 'DELETE'
            });
            
            if (response.ok) {
                // Refresh danh sách banner
                fetchBanners();
                // Ẩn modal
                hideDeleteModal();
                // Hiển thị thông báo thành công
                showNotification('Xóa banner thành công!', 'success');
            } else {
                throw new Error('Xóa banner thất bại');
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification('Có lỗi xảy ra khi xóa banner', 'error');
        }
    }

    // Hiển thị thông báo
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);

        // Tự động ẩn sau 3 giây
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
    
    window.onload = fetchBanners;
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const dropArea = document.getElementById('drop-area');
      const fileInput = document.getElementById('banner-image');
      const dropLabel = document.getElementById('drop-label');
      const bannerForm = document.getElementById('banner-form');
      const bannerModal = document.getElementById('bannerModal');

      function updateBannerFileName(files) {
          if (fileNameSpan) {
              if (files && files.length > 0) {
                  let names = [];
                  for (let i = 0; i < files.length; i++) {
                      names.push(files[i].name);
                  }
                  fileNameSpan.innerHTML = `<a class='file-link' href='#' onclick='return false;'>Đã chọn: ${names.join(', ')}</a>`;
              } else {
                  fileNameSpan.innerHTML = '';
              }
          }
      }
      function showBannerPreview() {
          if (bannerPreview) bannerPreview.innerHTML = '';
          if (fileInput.files && fileInput.files.length > 0) {
              const file = fileInput.files[0];
              if (file && file.type.startsWith('image/')) {
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      if (bannerPreview) bannerPreview.innerHTML = `
                        <div class='banner-preview-box'>
                          <img src='${e.target.result}' class='banner-preview-img' alt='preview'>
                          <button type='button' class='banner-preview-remove' title='Xóa ảnh' onclick='removeBannerPreview(event)'><i class="fa fa-times"></i></button>
                        </div>
                      `;
                  };
                  reader.readAsDataURL(file);
              }
          }
      }
      window.removeBannerPreview = function(e) {
          e.preventDefault();
          fileInput.value = '';
          if (fileNameSpan) fileNameSpan.innerHTML = '';
          if (bannerPreview) bannerPreview.innerHTML = '';
      };

      if (dropLabel && fileInput) {
          fileInput.addEventListener('change', function() {
              updateBannerFileName(fileInput.files);
              showBannerPreview();
          });
          dropLabel.addEventListener('dragover', function(e) {
              e.preventDefault();
              dropLabel.style.borderColor = '#6699ff';
          });
          dropLabel.addEventListener('dragleave', function(e) {
              e.preventDefault();
              dropLabel.style.borderColor = '#ddd';
          });
          dropLabel.addEventListener('drop', function(e) {
              e.preventDefault();
              dropLabel.style.borderColor = '#ddd';
              if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                  fileInput.files = e.dataTransfer.files;
                  updateBannerFileName(e.dataTransfer.files);
                  showBannerPreview();
              }
          });
      }
    });
    </script>
    <script>
    // Modal Sửa Banner
    const editBannerModal = document.getElementById('editBannerModal');
    const closeEditBannerModalBtn = document.getElementById('closeEditBannerModal');
    const editBannerForm = document.getElementById('edit-banner-form');
    const editBannerId = document.getElementById('edit-banner-id');
    const editBannerTitle = document.getElementById('edit-banner-title');
    const editBannerImage = document.getElementById('edit-banner-image');
    const editFileNameSpan = document.getElementById('edit-file-upload-name');
    const editBannerPreview = document.getElementById('edit-banner-preview');
    let currentEditBanner = null;

    function showEditBannerModal(banner) {
      currentEditBanner = banner;
      editBannerId.value = banner.id;
      editBannerTitle.value = banner.title;
      editBannerImage.value = '';
      editFileNameSpan.innerHTML = '';
      editBannerPreview.innerHTML = banner.image_url ? `<div class='banner-preview-box'><img src='${banner.image_url}' class='banner-preview-img' alt='preview'></div>` : '';
      editBannerModal.classList.add('show');
    }
    if (closeEditBannerModalBtn) {
      closeEditBannerModalBtn.onclick = () => {
        editBannerModal.classList.remove('show');
        editBannerForm.reset();
        editFileNameSpan.innerHTML = '';
        editBannerPreview.innerHTML = '';
      };
    }
    window.addEventListener('click', function(e) {
      if (e.target === editBannerModal) {
        editBannerModal.classList.remove('show');
        editBannerForm.reset();
        editFileNameSpan.innerHTML = '';
        editBannerPreview.innerHTML = '';
      }
    });
    // Xử lý chọn file và preview ảnh mới
    if (editBannerImage) {
      editBannerImage.addEventListener('change', function() {
        if (editBannerImage.files && editBannerImage.files.length > 0) {
          editFileNameSpan.innerHTML = `<a class='file-link' href='#' onclick='return false;'>Đã chọn: ${editBannerImage.files[0].name}</a>`;
          const reader = new FileReader();
          reader.onload = function(e) {
            editBannerPreview.innerHTML = `<div class='banner-preview-box'><img src='${e.target.result}' class='banner-preview-img' alt='preview'></div>`;
          };
          reader.readAsDataURL(editBannerImage.files[0]);
        } else {
          editFileNameSpan.innerHTML = '';
          editBannerPreview.innerHTML = currentEditBanner && currentEditBanner.image_url ? `<div class='banner-preview-box'><img src='${currentEditBanner.image_url}' class='banner-preview-img' alt='preview'></div>` : '';
        }
      });
    }
    // Sửa banner (gọi khi ấn nút Sửa)
    async function editBanner(id) {
      // Lấy dữ liệu banner hiện tại
      const res = await fetch(`${API_URL}`);
      const banners = await res.json();
      const banner = banners.find(b => b.id === id);
      if (!banner) return;
      showEditBannerModal(banner);
    }
    // Xử lý submit form sửa banner
    editBannerForm.onsubmit = async function(e) {
      e.preventDefault();
      const id = editBannerId.value;
      const title = editBannerTitle.value;
      const image = editBannerImage.files[0];
      try {
        let response, data;
        if (image) {
          // Nếu có ảnh mới, gửi FormData
          const formData = new FormData();
          formData.append('title', title);
          formData.append('image', image);
          response = await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            body: formData
          });
          data = await response.json();
        } else {
          // Nếu chỉ sửa tiêu đề
          response = await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, image_url: currentEditBanner.image_url })
          });
          data = await response.json();
        }
        if (!response.ok || data.success === false) {
          throw new Error(data.error || 'Sửa banner thất bại');
        }
        showNotification('Sửa banner thành công!', 'success');
        editBannerModal.classList.remove('show');
        editBannerForm.reset();
        editFileNameSpan.innerHTML = '';
        editBannerPreview.innerHTML = '';
        await fetchBanners();
      } catch (error) {
        showNotification(error.message || 'Có lỗi xảy ra khi sửa banner', 'error');
      }
    };
    </script>

    <script>
    const FEEDBACK_API_URL = '/api/inside';
    let feedbackToDelete = null;
    
    // Mapping value sang label cho phòng ban và loại ý kiến
    const departmentMap = {
      it: "Phòng IT",
      hr: "Phòng Nhân sự",
      marketing: "Phòng Marketing",
      sales: "Phòng Kinh doanh",
      airforce: "Phòng không không quân"
    };
    const feedbackTypeMap = {
      suggestion: "Đề xuất cải tiến",
      complaint: "Phản ánh vấn đề",
      praise: "Khen ngợi",
      other: "Khác"
    };
    const subFeedbackTypeMap = {
      // suggestion
      admin: "Cải cách hành chính",
      hr: "Bộ máy nhân sự",
      process: "Quy trình làm việc",
      // complaint
      workplace: "Môi trường làm việc",
      policy: "Chính sách",
      // praise
      team: "Đồng nghiệp",
      manager: "Quản lý",
      company: "Công ty",
      // other
      other: "Khác"
    };
    
    const MAILBOX_PAGE_SIZE = 6;
    let mailboxCurrentPage = 1;
    let mailboxData = [];
    let mailboxFilteredData = null;

    function getMailboxFilters() {
        const name = document.querySelector('#section-mailbox input[placeholder="Người gửi..."]').value.trim().toLowerCase();
        const phone = document.querySelector('#section-mailbox input[placeholder="Số điện thoại..."]').value.trim();
        const department = document.querySelector('#section-mailbox select.admin-filter-select:nth-of-type(1)').value;
        const type = document.querySelector('#section-mailbox select.admin-filter-select:nth-of-type(2)').value;
        const date = document.querySelector('#section-mailbox input[type="date"]').value;
        return { name, phone, department, type, date };
    }

    function filterMailboxData() {
        const { name, phone, department, type, date } = getMailboxFilters();
        return mailboxData.filter(item => {
            let ok = true;
            if (name && !(item.full_name || '').toLowerCase().includes(name)) ok = false;
            if (phone && !(item.phone || '').includes(phone)) ok = false;
            if (department && item.department !== department) ok = false;
            if (type && item.feedback_type !== type) ok = false;
            if (date && item.created_at) {
                const itemDate = new Date(item.created_at);
                const itemDateStr = itemDate.getFullYear() + '-' +
                    String(itemDate.getMonth() + 1).padStart(2, '0') + '-' +
                    String(itemDate.getDate()).padStart(2, '0');
                if (itemDateStr !== date) ok = false;
            }
            return ok;
        });
    }

    async function loadMailbox(page = 1, filtered = false) {
        const res = await fetch(FEEDBACK_API_URL);
        mailboxData = await res.json();
        mailboxCurrentPage = page;
        if (filtered && mailboxFilteredData) {
            renderMailboxTable(mailboxFilteredData);
            renderMailboxPagination(mailboxFilteredData);
        } else {
            mailboxFilteredData = null;
            renderMailboxTable(mailboxData);
            renderMailboxPagination(mailboxData);
        }
    }

    function renderMailboxTable(dataArr) {
        const tbody = document.querySelector('#section-mailbox .admin-table tbody');
        tbody.innerHTML = '';
        const start = (mailboxCurrentPage - 1) * MAILBOX_PAGE_SIZE;
        const end = start + MAILBOX_PAGE_SIZE;
        const pageData = dataArr.slice(start, end);
        pageData.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${item.full_name}</td>
                <td>${item.email || ''}</td>
                <td>${item.phone || ''}</td>
                <td>${departmentMap[item.department] || item.department || ''}</td>
                <td>${feedbackTypeMap[item.feedback_type] || item.feedback_type || ''}</td>
                <td>${subFeedbackTypeMap[item.sub_feedback_type] || item.sub_feedback_type || ''}</td>
                <td>${item.attachment ? `<a href="/feedback_files/${item.attachment}" target="_blank">${item.attachment}</a>` : ''}</td>
                <td>${item.created_at ? new Date(item.created_at).toLocaleDateString() : ''}</td>
                <td>
                    <button class="action-btn delete-btn" data-id="${item.id}"><i class="fa-solid fa-trash"></i></button>
                    <button class="action-btn detail-btn" data-id="${item.id}"><i class="fa-solid fa-eye"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
        });
        // Gắn lại sự kiện cho nút xem chi tiết và xóa
        document.querySelectorAll('#section-mailbox .detail-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                showFeedbackDetail(this.dataset.id);
            });
        });
        document.querySelectorAll('#section-mailbox .delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = this.dataset.id;
                showConfirmDeleteModal('Bạn có chắc chắn muốn xóa ý kiến này?', async function() {
                    try {
                        const res = await fetch(FEEDBACK_API_URL + '/' + id, { method: 'DELETE' });
                        if (res.ok) {
                            showNotification('Xóa ý kiến thành công!', 'success');
                            loadMailbox();
                        } else {
                            showNotification('Xóa ý kiến thất bại!', 'error');
                        }
                    } catch (e) {
                        showNotification('Có lỗi xảy ra khi xóa!', 'error');
                    }
                });
            });
        });
        // Luôn gọi phân trang sau khi render bảng
        renderMailboxPagination(dataArr);
    }

    function renderMailboxPagination(dataArr) {
        const pagDiv = document.getElementById('mailbox-pagination');
        pagDiv.innerHTML = '';
        const total = dataArr.length;
        const totalPages = Math.ceil(total / MAILBOX_PAGE_SIZE);
        if (totalPages <= 1) {
            pagDiv.style.display = 'none';
            return;
        }
        pagDiv.style.display = 'flex';
        pagDiv.style.justifyContent = 'center';
        pagDiv.style.alignItems = 'center';
        pagDiv.style.gap = '8px';
        pagDiv.style.margin = '18px 0 0 0';

        // Prev button
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '<';
        prevBtn.className = 'pagination-btn';
        prevBtn.disabled = mailboxCurrentPage === 1;
        prevBtn.onclick = () => {
            if (mailboxCurrentPage > 1) {
                mailboxCurrentPage--;
                renderMailboxTable(mailboxFilteredData || mailboxData);
                renderMailboxPagination(mailboxFilteredData || mailboxData);
            }
        };
        pagDiv.appendChild(prevBtn);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.textContent = i;
            btn.className = 'pagination-btn';
            if (i === mailboxCurrentPage) {
                btn.style.fontWeight = 'bold';
                btn.style.backgroundColor = '#1976d2';
                btn.style.color = 'white';
            }
            btn.onclick = () => {
                mailboxCurrentPage = i;
                renderMailboxTable(mailboxFilteredData || mailboxData);
                renderMailboxPagination(mailboxFilteredData || mailboxData);
            };
            pagDiv.appendChild(btn);
        }

        // Next button
        const nextBtn = document.createElement('button');
        nextBtn.textContent = '>';
        nextBtn.className = 'pagination-btn';
        nextBtn.disabled = mailboxCurrentPage === totalPages;
        nextBtn.onclick = () => {
            if (mailboxCurrentPage < totalPages) {
                mailboxCurrentPage++;
                renderMailboxTable(mailboxFilteredData || mailboxData);
                renderMailboxPagination(mailboxFilteredData || mailboxData);
            }
        };
        pagDiv.appendChild(nextBtn);
    }
    // Thêm style cho phân trang nếu chưa có
    if (!document.getElementById('pagination-style')) {
        const style = document.createElement('style');
        style.id = 'pagination-style';
        style.textContent = `
            .pagination-btn {
                padding: 6px 12px;
                margin: 0 4px;
                border: 1px solid #ddd;
                background: white;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.2s;
            }
            .pagination-btn:hover:not(:disabled) {
                background: #f5f5f5;
            }
            .pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
        `;
        document.head.appendChild(style);
    }

    // Gắn sự kiện cho nút Lọc
    const mailboxFilterBtn = document.querySelector('#section-mailbox .admin-filter-btn');
    if (mailboxFilterBtn) {
        mailboxFilterBtn.onclick = function() {
            mailboxFilteredData = filterMailboxData();
            mailboxCurrentPage = 1;
            renderMailboxTable(mailboxFilteredData);
            renderMailboxPagination(mailboxFilteredData);
        };
    }
    // Khi chuyển sang tab "Quản lý hòm thư"
    document.querySelector('[data-section="mailbox"]').addEventListener('click', () => {
        mailboxFilteredData = null;
        loadMailbox(1);
    });

    // Xem chi tiết góp ý
    async function showFeedbackDetail(id) {
        const res = await fetch(FEEDBACK_API_URL + '/' + id);
        const data = await res.json();
        let html = `
            <p><b>Người gửi:</b> ${data.full_name}</p>
            <p><b>Email:</b> ${data.email || ''}</p>
            <p><b>Số điện thoại:</b> ${data.phone || ''}</p>
            <p><b>Phòng ban:</b> ${departmentMap[data.department] || data.department || ''}</p>
            <p><b>Loại ý kiến:</b> ${feedbackTypeMap[data.feedback_type] || data.feedback_type || ''}</p>
            <p><b>Loại ý kiến con:</b> ${subFeedbackTypeMap[data.sub_feedback_type] || data.sub_feedback_type || ''}</p>
            <p><b>Ngày gửi:</b> ${data.created_at ? new Date(data.created_at).toLocaleString() : ''}</p>
            <p><b>Nội dung ý kiến:</b><br><span style="white-space:pre-line">${data.content}</span></p>
            ${data.attachment ? `<p><b>Tệp đính kèm:</b> <a href="/feedback_files/${data.attachment}" target="_blank">${data.attachment}</a></p>` : ''}
        `;
        document.getElementById('feedbackDetailContent').innerHTML = html;
        document.getElementById('feedbackDetailModal').style.display = 'flex';
    }
    
    // Xác nhận xóa góp ý
    document.getElementById('confirmDeleteFeedbackBtn').onclick = async function() {
        if (!feedbackToDelete) return;
        try {
            const res = await fetch(FEEDBACK_API_URL + '/' + feedbackToDelete, { method: 'DELETE' });
            if (res.ok) {
                showNotification('Xóa ý kiến thành công!', 'success');
                loadMailbox();
            } else {
                showNotification('Xóa ý kiến thất bại!', 'error');
            }
        } catch (e) {
            showNotification('Có lỗi xảy ra khi xóa!', 'error');
        }
        document.getElementById('deleteFeedbackModal').style.display = 'none';
        feedbackToDelete = null;
    };
    </script>

    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script>
    // Hàm xuất Excel cho bảng quản lý hòm thư
    function exportMailboxToExcel() {
        // Lấy dữ liệu hiện tại (toàn bộ mailboxData, không chỉ trang hiện tại)
        const headers = [
            "Người gửi", "Email", "Số điện thoại", "Phòng ban",
            "Loại ý kiến", "Chi tiết ý kiến", "Tệp đính kèm", "Ngày gửi"
        ];
        const rows = mailboxData.map(item => [
            item.full_name,
            item.email || '',
            item.phone || '',
            departmentMap[item.department] || item.department || '',
            feedbackTypeMap[item.feedback_type] || item.feedback_type || '',
            subFeedbackTypeMap[item.sub_feedback_type] || item.sub_feedback_type || '',
            item.attachment ? (location.origin + "/feedback_files/" + item.attachment) : '',
            item.created_at ? new Date(item.created_at).toLocaleDateString() : ''
        ]);
        const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Mailbox");
        XLSX.writeFile(wb, "mailbox.xlsx");
    }
    // Gắn sự kiện cho nút xuất excel
    const exportMailboxBtn = document.getElementById('export-excel-mailbox');
    if (exportMailboxBtn) exportMailboxBtn.onclick = exportMailboxToExcel;
    </script>
    <script>
    const mailboxRefreshBtn = document.getElementById('mailbox-refresh-btn');
    if (mailboxRefreshBtn) {
        mailboxRefreshBtn.onclick = function() {
            // Xóa toàn bộ filter
            document.querySelector('#section-mailbox input[placeholder="Người gửi..."]').value = '';
            document.querySelector('#section-mailbox input[placeholder="Số điện thoại..."]').value = '';
            document.querySelector('#section-mailbox select.admin-filter-select:nth-of-type(1)').value = '';
            document.querySelector('#section-mailbox select.admin-filter-select:nth-of-type(2)').value = '';
            document.querySelector('#section-mailbox input[type="date"]').value = '';
            mailboxFilteredData = null;
            mailboxCurrentPage = 1;
            renderMailboxTable(mailboxData);
            renderMailboxPagination(mailboxData);
        };
    }
    </script>

    
    <!-- Xử lý trang news -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
    // Biến DOM
    const addNewsBtn = document.getElementById('add-news-btn');
    const addNewsModal = document.getElementById('addNewsModal');
    const closeNewsModal = document.getElementById('closeNewsModal');
    const addNewsForm = document.getElementById('addNewsForm');
    const newsImageInput = document.getElementById('newsImage');
    const newsFileNameSpan = document.getElementById('news-file-upload-name');
    const newsPreviewDiv = document.getElementById('news-preview');
    const saveBtn = document.getElementById('saveNewsBtn');
    const newsTab = document.querySelector('[data-section="news"]');
    const tbody = document.querySelector('#section-news .admin-table tbody');

    // Thêm div phân trang
    const paginationDiv = document.createElement('div');
    paginationDiv.id = 'news-pagination';
    paginationDiv.style.cssText = 'display:flex;justify-content:center;align-items:center;gap:8px;margin:18px 0 0 0;';
    document.querySelector('#section-news').appendChild(paginationDiv);

    let editingId = null;
    const NEWS_PAGE_SIZE = 6;
    let newsCurrentPage = 1;
    let newsData = [];
    let newsFilteredData = null;

    // Mở modal thêm mới
    addNewsBtn?.addEventListener('click', () => {
        resetForm();
        editingId = null;
        saveBtn.textContent = 'Lưu tin tức';
        addNewsModal.style.display = 'flex';
    });

    // Đóng modal
    closeNewsModal?.addEventListener('click', closeModal);
    window.addEventListener('click', (e) => {
        if (e.target === addNewsModal) closeModal();
    });

    function closeModal() {
        addNewsModal.style.display = 'none';
        resetForm();
        editingId = null;
    }

    function resetForm() {
        addNewsForm.reset();
        newsPreviewDiv.innerHTML = '';
        newsFileNameSpan.innerHTML = '';
    }

    // Xử lý chọn ảnh
    newsImageInput?.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function () {
                newsFileNameSpan.innerHTML = `<span style='color:#1976d2;margin-left:8px;'>Đã chọn: ${file.name}</span>`;
            };
            reader.readAsDataURL(file);
        } else {
            newsFileNameSpan.innerHTML = '';
        }
    });

    // Xử lý submit form (thêm/sửa)
    addNewsForm.onsubmit = async function (e) {
        e.preventDefault();
        if (!addNewsForm.checkValidity()) {
            addNewsForm.reportValidity();
            return;
        }

        const formData = new FormData(addNewsForm);
        let url = '/api/news';
        let method = 'POST';

        if (editingId) {
            url = `/api/news/${editingId}`;
            method = 'PUT';
        }

        try {
            const response = await fetch(url, { method, body: formData });
            const result = await response.json();
            if (!response.ok || !result.success) {
                throw new Error(result.error || 'Lỗi khi lưu tin tức');
            }
            showNotification('Thêm tin tức thành công!', 'success');
            closeModal();
            editingId = null;
            saveBtn.textContent = 'Lưu tin tức';
            loadNews(1); // Reset về trang 1 sau khi thêm/sửa
        } catch (err) {
            showNotification(err.message || 'Có lỗi xảy ra khi lưu tin tức', 'error');
        }
    };

    // Hàm hiển thị modal sửa tin tức
    function showEditNewsModal(news) {
        document.getElementById('newsTitle').value = news.title || '';
        document.getElementById('newsAuthor').value = news.author || '';
        document.getElementById('newsDepartment').value = news.department || '';
        document.getElementById('newsCategory').value = news.category || '';
        document.getElementById('newsSummary').value = news.summary || '';
        document.getElementById('newsContent').value = news.content || '';
        newsImageInput.value = '';
        editingId = news.id;
        saveBtn.textContent = 'Cập nhật';
        addNewsModal.style.display = 'flex';
    }

    function renderNewsTable(dataArr) {
        tbody.innerHTML = '';
        const start = (newsCurrentPage - 1) * NEWS_PAGE_SIZE;
        const end = start + NEWS_PAGE_SIZE;
        const pageData = dataArr.slice(start, end);
        
        if (pageData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:20px;">Không có dữ liệu</td></tr>';
            return;
        }

        pageData.forEach((item) => {
            tbody.innerHTML += `
                <tr data-id="${item.id}">
                    <td>${item.id}</td>
                    <td>${item.title}</td>
                    <td>${item.author || ''}</td>
                    <td>${item.department || ''}</td>
                    <td>${item.created_at ? new Date(item.created_at).toLocaleDateString() : ''}</td>
                    <td>
                        <button class="action-btn delete-btn" title="Xóa"><i class="fa-solid fa-trash"></i></button>
                        <button class="action-btn edit-btn" title="Sửa"><i class="fa-solid fa-pen"></i></button>
                        <button class="action-btn detail-btn" title="Xem chi tiết"><i class="fa-solid fa-eye"></i></button>
                    </td>
                </tr>
            `;
        });

        // Gán sự kiện cho các nút sau khi render
        document.querySelectorAll('#section-news .delete-btn').forEach(btn => {
            btn.onclick = function () {
                const id = this.closest('tr').dataset.id;
                showConfirmDeleteModal('Bạn có chắc chắn muốn xóa tin tức này?', async function() {
                    try {
                        const res = await fetch(`/api/news/${id}`, { method: 'DELETE' });
                        const data = await res.json();
                        if (data.success) {
                            showNotification('Xóa tin tức thành công!', 'success');
                            loadNews(1);
                        } else {
                            showNotification(data.error || 'Xóa thất bại!', 'error');
                        }
                    } catch (error) {
                        showNotification('Có lỗi xảy ra khi xóa!', 'error');
                    }
                });
            };
        });

        document.querySelectorAll('#section-news .edit-btn').forEach(btn => {
            btn.onclick = async function () {
                const id = this.closest('tr').dataset.id;
                try {
                    const res = await fetch(`/api/news/${id}`);
                    const news = await res.json();
                    showEditNewsModal(news);
                } catch (error) {
                    showNotification('Có lỗi xảy ra khi tải thông tin tin tức!', 'error');
                }
            };
        });

        document.querySelectorAll('#section-news .detail-btn').forEach(btn => {
            btn.onclick = function () {
                const id = this.closest('tr').dataset.id;
                window.open(`news-detail.html?id=${id}`, '_blank');
            };
        });
    }

    function renderNewsPagination(dataArr) {
        const pagDiv = document.getElementById('news-pagination');
        pagDiv.innerHTML = '';
        const total = dataArr.length;
        const totalPages = Math.ceil(total / NEWS_PAGE_SIZE);
        
        if (totalPages <= 1) {
            pagDiv.style.display = 'none';
            return;
        }
        
        pagDiv.style.display = 'flex';

        // Prev button
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '<';
        prevBtn.className = 'pagination-btn';
        prevBtn.disabled = newsCurrentPage === 1;
        prevBtn.onclick = () => {
            if (newsCurrentPage > 1) {
                newsCurrentPage--;
                renderNewsTable(newsFilteredData || newsData);
                renderNewsPagination(newsFilteredData || newsData);
            }
        };
        pagDiv.appendChild(prevBtn);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.textContent = i;
            btn.className = 'pagination-btn';
            if (i === newsCurrentPage) {
                btn.style.fontWeight = 'bold';
                btn.style.backgroundColor = '#1976d2';
                btn.style.color = 'white';
            }
            btn.onclick = () => {
                newsCurrentPage = i;
                renderNewsTable(newsFilteredData || newsData);
                renderNewsPagination(newsFilteredData || newsData);
            };
            pagDiv.appendChild(btn);
        }

        // Next button
        const nextBtn = document.createElement('button');
        nextBtn.textContent = '>';
        nextBtn.className = 'pagination-btn';
        nextBtn.disabled = newsCurrentPage === totalPages;
        nextBtn.onclick = () => {
            if (newsCurrentPage < totalPages) {
                newsCurrentPage++;
                renderNewsTable(newsFilteredData || newsData);
                renderNewsPagination(newsFilteredData || newsData);
            }
        };
        pagDiv.appendChild(nextBtn);
    }

    // Hàm load danh sách tin tức
    async function loadNews(page = 1, filtered = false) {
        try {
            const res = await fetch('/api/news');
            newsData = await res.json();
            newsCurrentPage = page;
            
            if (filtered && newsFilteredData) {
                renderNewsTable(newsFilteredData);
                renderNewsPagination(newsFilteredData);
            } else {
                newsFilteredData = null;
                renderNewsTable(newsData);
                renderNewsPagination(newsData);
            }
        } catch (error) {
            showNotification('Không thể tải tin tức!', 'error');
        }
    }

    // Thêm chức năng lọc
    const newsFilterBtn = document.querySelector('#section-news .admin-filter-btn');
    if (newsFilterBtn) {
        newsFilterBtn.onclick = function() {
            const title = document.querySelector('#section-news input[placeholder="Tiêu đề..."]').value.trim().toLowerCase();
            const author = document.querySelector('#section-news input[placeholder="Người viết..."]').value.trim().toLowerCase();
            const department = document.querySelector('#section-news select').value;
            const date = document.querySelector('#section-news input[type="date"]').value;

            newsFilteredData = newsData.filter(item => {
                let ok = true;
                if (title && !(item.title || '').toLowerCase().includes(title)) ok = false;
                if (author && !(item.author || '').toLowerCase().includes(author)) ok = false;
                if (department && item.department !== departmentMap[department]) ok = false;
                if (date && item.created_at) {
                    const itemDate = new Date(item.created_at);
                    const itemDateStr = itemDate.getFullYear() + '-' +
                        String(itemDate.getMonth() + 1).padStart(2, '0') + '-' +
                        String(itemDate.getDate()).padStart(2, '0');
                    if (itemDateStr !== date) ok = false;
                }
                return ok;
            });

            newsCurrentPage = 1; // Reset về trang 1 khi lọc
            renderNewsTable(newsFilteredData);
            renderNewsPagination(newsFilteredData);
        };
    }

    // Thêm nút làm mới
    const newsRefreshBtn = document.createElement('button');
    newsRefreshBtn.className = 'admin-filter-btn';
    newsRefreshBtn.style.cssText = 'background:#e3eaf2;color:#1976d2;';
    newsRefreshBtn.innerHTML = '<i class="fa-solid fa-rotate"></i> Làm mới';
    newsRefreshBtn.onclick = function() {
        // Reset các input filter
        document.querySelector('#section-news input[placeholder="Tiêu đề..."]').value = '';
        document.querySelector('#section-news input[placeholder="Người viết..."]').value = '';
        document.querySelector('#section-news select').value = '';
        document.querySelector('#section-news input[type="date"]').value = '';
        
        // Reset dữ liệu và phân trang
        newsFilteredData = null;
        newsCurrentPage = 1;
        renderNewsTable(newsData);
        renderNewsPagination(newsData);
    };
    document.querySelector('#section-news .admin-filter-bar').appendChild(newsRefreshBtn);

    // Tự động load lại khi chuyển tab
    newsTab?.addEventListener('click', () => {
        newsFilteredData = null;
        newsCurrentPage = 1;
        loadNews(1);
    });

    // Tải danh sách ban đầu
    loadNews();

    // Thêm style cho phân trang
    const style = document.createElement('style');
    style.textContent = `
        .pagination-btn {
            padding: 6px 12px;
            margin: 0 4px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .pagination-btn:hover:not(:disabled) {
            background: #f5f5f5;
        }
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    `;
    document.head.appendChild(style);
});
    </script>
    <!-- Thêm tài khoản -->
    <!-- Modal thêm/sửa tài khoản (đẹp, đồng bộ modal tin tức) -->
    <div id="userModalOverlay" class="custom-modal-overlay" style="display:none;">
    <div class="custom-modal user-modal">
        <button class="custom-modal-close" onclick="closeUserModal()" title="Đóng">
        <i class="fa-solid fa-xmark"></i>
        </button>
        <h2 class="custom-modal-title">Thêm tài khoản mới</h2>
        <form id="addUserForm" autocomplete="off">
        <input name="full_name" type="text" class="custom-input" placeholder="Họ tên" required>
        <select name="department" class="custom-input" required>
            <option value="">Chọn phòng ban</option>
            <option value="ACC">ACC</option>
            <option value="ACC IOB">ACC IOB</option>
            <option value="AHR">AHR</option>
            <option value="BOD">BOD</option>
            <option value="DES">DES</option>
            <option value="FIN">FIN</option>
            <option value="IOB">IOB</option>
            <option value="IOB DT">IOB DT</option>
            <option value="ITS">ITS</option>
            <option value="OPE">OPE</option>
            <option value="OPE-HN">OPE-HN</option>
            <option value="PCC">PCC</option>
            <option value="PDH">PDH</option>
            <option value="PLA">PLA</option>
            <option value="SQC">SQC</option>
            <option value="VPHN">VPHN</option>
            <option value="WHR">WHR</option>
        </select>
        <input name="email" type="email" class="custom-input" placeholder="Email">
        <input name="password_user" type="password" class="custom-input" placeholder="Mật khẩu" required style="display:block;">
        <input name="birth_day" type="date" class="custom-input" placeholder="Ngày sinh">
        <select name="role" class="custom-input">
            <option value="user">User</option>
            <option value="admin">Admin</option>
        </select>
        <div class="custom-modal-actions">
            <button type="button" class="custom-btn custom-btn-cancel" onclick="closeUserModal()">Đóng</button>
            <button type="submit" class="custom-btn custom-btn-save">Lưu tài khoản</button>
        </div>
        </form>
    </div>
    </div>
    <script>
        // Mở modal khi bấm nút Thêm
        document.getElementById('addUserBtn').onclick = function() {
            document.getElementById('userModalOverlay').style.display = 'flex';
            document.getElementById('addUserForm').reset();
            document.getElementById('addUserForm').removeAttribute('data-edit-id');
            document.querySelector('.custom-modal-title').textContent = 'Thêm tài khoản mới';
            document.querySelector('.custom-btn-save').textContent = 'Lưu tài khoản';
            document.querySelector('#addUserForm [name=password_user]').style.display = 'block';
            document.querySelector('#addUserForm [name=password_user]').setAttribute('required', 'required');
        };
        // Đóng modal
        function closeUserModal() {
        document.getElementById('userModalOverlay').style.display = 'none';
        document.getElementById('addUserForm').reset();
        }
        // Đóng modal khi click ra ngoài
        document.getElementById('userModalOverlay').onclick = function(e) {
        if (e.target === this) closeUserModal();
        };
    </script>
    <script>
        const USER_PAGE_SIZE = 6;
        let userCurrentPage = 1;
        let userTotal = 0;

        // Load danh sách user
        async function loadUsers(page = 1) {
            try {
                const res = await fetch(`/api/users?page=${page}&pageSize=${USER_PAGE_SIZE}`);
                const data = await res.json();
                if (!data.success) throw new Error(data.error || 'Không thể tải tài khoản');
                renderUserTable(data.users);
                renderUserPagination(data.total, page); // Đảm bảo gọi hàm này ở đây
                userCurrentPage = page;
                userTotal = data.total;
            } catch (err) {
                showNotification(err.message, 'error');
            }
        }

        // Render bảng user
        function renderUserTable(users) {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            if (!users.length) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Không có dữ liệu</td></tr>';
                return;
            }
            users.forEach(user => {
                let birthDay = user.birth_day ? new Date(user.birth_day) : null;
                let birthDayStr = birthDay ? `${(birthDay.getMonth()+1).toString().padStart(2,'0')}/${birthDay.getDate().toString().padStart(2,'0')}/${birthDay.getFullYear()}` : '';
                tbody.innerHTML += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.full_name}</td>
                        <td>${user.department || ''}</td>
                        <td>${user.email || ''}</td>
                        <td>********</td>
                        <td>${birthDayStr}</td>
                        <td>${user.role || ''}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${user.id}"><i class="fa-solid fa-pen"></i></button>
                            <button class="action-btn delete-btn" data-id="${user.id}"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });

            // Gán sự kiện xóa
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.onclick = async function() {
                    if (!confirm('Bạn có chắc chắn muốn xóa tài khoản này?')) return;
                    const id = this.dataset.id;
                    try {
                        const res = await fetch(`/api/users/${id}`, { method: 'DELETE' });
                        const data = await res.json();
                        if (data.success) {
                            showNotification('Xóa tài khoản thành công!', 'success');
                            loadUsers(userCurrentPage);
                        } else {
                            showNotification('Có lỗi xảy ra khi xóa!', 'error');
                        }
                    } catch (err) {
                        showNotification('Có lỗi xảy ra khi xóa!', 'error');
                    }
                };
            });

            // Gán sự kiện sửa
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.onclick = async function() {
                    const id = this.dataset.id;
                    try {
                        const res = await fetch(`/api/users?page=1&pageSize=1&id=${id}`);
                        const user = (await res.json()).users[0];
                        if (!user) return showNotification('Không tìm thấy tài khoản!', 'error');
                        document.querySelector('#addUserForm [name=full_name]').value = user.full_name || '';
                        document.querySelector('#addUserForm [name=department]').value = user.department || '';
                        document.querySelector('#addUserForm [name=email]').value = user.email || '';
                        // Format ngày sinh về yyyy-MM-dd
                        if (user.birth_day) {
                            const d = new Date(user.birth_day);
                            if (!isNaN(d)) {
                                const yyyy = d.getFullYear();
                                const mm = String(d.getMonth() + 1).padStart(2, '0');
                                const dd = String(d.getDate()).padStart(2, '0');
                                document.querySelector('#addUserForm [name=birth_day]').value = `${yyyy}-${mm}-${dd}`;
                            } else {
                                document.querySelector('#addUserForm [name=birth_day]').value = '';
                            }
                        } else {
                            document.querySelector('#addUserForm [name=birth_day]').value = '';
                        }
                        document.querySelector('#addUserForm [name=role]').value = user.role || 'user';
                        document.querySelector('#addUserForm [name=password_user]').value = '';
                        document.getElementById('userModalOverlay').style.display = 'flex';
                        document.getElementById('addUserForm').setAttribute('data-edit-id', id);
                        document.querySelector('.custom-modal-title').textContent = 'Sửa tài khoản';
                        document.querySelector('.custom-btn-save').textContent = 'Cập nhật';
                        document.querySelector('#addUserForm [name=password_user]').style.display = 'none';
                        document.querySelector('#addUserForm [name=password_user]').removeAttribute('required');
                    } catch (err) {
                        showNotification('Có lỗi khi tải thông tin!', 'error');
                    }
                };
            });
        }

        // Xử lý submit form thêm/sửa user
        document.getElementById('addUserForm').onsubmit = async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            const editId = this.getAttribute('data-edit-id');
            let url = '/api/users', method = 'POST';
            if (editId) {
                url = `/api/users/${editId}`;
                method = 'PUT';
            }
            try {
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.success) {
                    showNotification('Thêm tài khoản thành công!', 'success');
                    closeUserModal();
                    this.removeAttribute('data-edit-id');
                    loadUsers(userCurrentPage);
                } else {
                    showNotification('Có lỗi xảy ra!', 'error');
                }
            } catch (err) {
                showNotification('Lỗi kết nối server!', 'error');
            }
        };

        // Mở modal thêm user
        document.getElementById('addUserBtn').onclick = function() {
            document.getElementById('userModalOverlay').style.display = 'flex';
        };

        // Đóng modal
        function closeUserModal() {
            document.getElementById('userModalOverlay').style.display = 'none';
            document.getElementById('addUserForm').reset();
            document.getElementById('addUserForm').removeAttribute('data-edit-id');
        }

        // Đóng modal khi click ra ngoài
        document.getElementById('userModalOverlay').onclick = function(e) {
            if (e.target === this) closeUserModal();
        };

        // Tải danh sách user ban đầu
        loadUsers();
    </script>
    <script>
    function showNotification(message, type = 'success') {
        let noti = document.createElement('div');
        noti.className = `custom-notification ${type}`;
        noti.innerText = message;
        document.body.appendChild(noti);
        setTimeout(() => { noti.classList.add('show'); }, 10);
        setTimeout(() => {
            noti.classList.remove('show');
            setTimeout(() => noti.remove(), 400);
        }, 2200);
    }

    // Thay alert trong các thao tác user bằng showNotification
    // ... các hàm loadUsers, renderUserTable, submit form ...
    // Ví dụ:
    // showNotification('Thêm tài khoản thành công!', 'success');
    // showNotification('Có lỗi xảy ra!', 'error');
    </script>
    <script>
    function renderUserPagination(total, currentPage) {
        const pagDiv = document.getElementById('userPagination');
        pagDiv.innerHTML = '';
        const totalPages = Math.ceil(total / USER_PAGE_SIZE);
        if (totalPages <= 1) return;
        // Prev button
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '<';
        prevBtn.className = 'pagination-btn';
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => {
            if (currentPage > 1) loadUsers(currentPage - 1);
        };
        pagDiv.appendChild(prevBtn);
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.textContent = i;
            btn.className = 'pagination-btn';
            if (i === currentPage) {
                btn.style.fontWeight = 'bold';
                btn.style.backgroundColor = '#1976d2';
                btn.style.color = 'white';
            }
            btn.onclick = () => loadUsers(i);
            pagDiv.appendChild(btn);
        }
        // Next button
        const nextBtn = document.createElement('button');
        nextBtn.textContent = '>';
        nextBtn.className = 'pagination-btn';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.onclick = () => {
            if (currentPage < totalPages) loadUsers(currentPage + 1);
        };
        pagDiv.appendChild(nextBtn);
    }
    </script>
    <script>
    // ========== QUẢN LÝ BXH ========== //
    const RANKING_API_URL = '/api/rankings';
    let rankingData = [];
    let rankingMembersData = [];

    // Load danh sách BXH
    async function loadRankings() {
        const department = document.querySelector('#section-ranking select.admin-filter-select:nth-of-type(1)').value;
        const category = document.querySelector('#section-ranking select.admin-filter-select:nth-of-type(2)').value;
        const month = document.querySelector('#section-ranking select.admin-filter-select:nth-of-type(3)').value;
        const year = document.querySelector('#section-ranking select.admin-filter-select:nth-of-type(4)').value;
        const params = new URLSearchParams({ department, category, month, year });
        const res = await fetch(`${RANKING_API_URL}?${params}`);
        rankingData = await res.json();
        renderRankingTable();
    }

    // Render bảng BXH
    function renderRankingTable() {
        const tbody = document.getElementById('rankingTableBody');
        tbody.innerHTML = '';
        if (!rankingData.length) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:20px;">Không có dữ liệu</td></tr>';
            return;
        }
        rankingData.forEach(item => {
            tbody.innerHTML += `
                <tr data-id="${item.id}">
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.department}</td>
                    <td>${item.category}</td>
                    <td>${item.month}</td>
                    <td>${item.year}</td>
                    <td>${item.created_by}</td>
                    <td>
                        <button class="action-btn delete-btn"><i class="fa-solid fa-trash"></i></button>
                        <button class="action-btn edit-btn"><i class="fa-solid fa-pen"></i></button>
                        <button class="action-btn detail-btn"><i class="fa-solid fa-eye"></i></button>
                    </td>
                </tr>
            `;
        });
        // Gán sự kiện cho các nút
        document.querySelectorAll('#section-ranking .delete-btn').forEach(btn => {
            btn.onclick = async function () {
                const id = this.closest('tr').dataset.id;
                if (confirm('Bạn có chắc chắn muốn xóa BXH này?')) {
                    await fetch(`${RANKING_API_URL}/${id}`, { method: 'DELETE' });
                    loadRankings();
                }
            };
        });
        document.querySelectorAll('#section-ranking .detail-btn').forEach(btn => {
            btn.onclick = function () {
                const id = this.closest('tr').dataset.id;
                showRankingDetailModal(id);
            };
        });
        // TODO: Gán sự kiện cho nút edit-btn nếu cần
    }

    // Hiển thị modal chi tiết BXH
    async function showRankingDetailModal(rankingId) {
        currentRankingDetailId = rankingId;
        const res = await fetch(`${RANKING_API_URL}/${rankingId}/members`);
        rankingMembersData = await res.json();
        renderRankingMembers();
        document.getElementById('bxhDetailModal').style.display = 'flex';
        document.getElementById('addRankingMemberBtn').onclick = function() {
            openRankingMemberModal(rankingId);
        };
    }

    // Render thành viên BXH trong modal
    function renderRankingMembers() {
        const tbody = document.getElementById('rankingMembersTableBody');
        tbody.innerHTML = '';
        if (!rankingMembersData.length) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:20px;">Không có dữ liệu</td></tr>';
            return;
        }
        rankingMembersData.forEach(item => {
            tbody.innerHTML += `
                <tr data-id="${item.id}">
                    <td>${item.id}</td>
                    <td>${item.full_name}</td>
                    <td>${item.department}</td>
                    <td>${item.category || ''}</td>
                    <td>${item.month || ''}/${item.year || ''}</td>
                    <td>${item.avatar ? `<img src="${item.avatar}" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">` : ''}</td>
                    <td>${item.position}</td>
                    <td><button class="action-btn edit-btn"><i class="fa-solid fa-pen"></i></button></td>
                </tr>
            `;
        });
        // TODO: Gán sự kiện cho nút edit-btn nếu cần
    }

    // Gắn sự kiện filter BXH
    const rankingFilterBtn = document.querySelector('#section-ranking .admin-filter-btn');
    if (rankingFilterBtn) rankingFilterBtn.onclick = loadRankings;
    // Tự động load BXH khi chuyển tab
    const rankingTab = document.querySelector('[data-section="ranking"]');
    if (rankingTab) rankingTab.addEventListener('click', loadRankings);
    // Load BXH lần đầu
    if (document.getElementById('section-ranking').style.display !== 'none') loadRankings();
    </script>
    <!-- Modal Thêm/Sửa BXH -->
    <div id="rankingModal" class="custom-modal-overlay" style="display:none;">
      <div class="custom-modal user-modal">
        <button class="custom-modal-close" onclick="closeRankingModal()" title="Đóng">
          <i class="fa-solid fa-xmark"></i>
        </button>
        <h2 class="custom-modal-title" id="rankingModalTitle">Thêm BXH</h2>
        <form id="rankingForm" autocomplete="off">
          <input name="name" type="text" class="custom-input" placeholder="Tên BXH" required>
          <select name="department" class="custom-input" required>
            <option value="">Chọn phòng ban</option>
            <option value="ACC">ACC</option>
            <option value="ACC IOB">ACC IOB</option>
            <option value="AHR">AHR</option>
            <option value="BOD">BOD</option>
            <option value="DES">DES</option>
            <option value="FIN">FIN</option>
            <option value="IOB">IOB</option>
            <option value="IOB DT">IOB DT</option>
            <option value="ITS">ITS</option>
            <option value="OPE">OPE</option>
            <option value="OPE-HN">OPE-HN</option>
            <option value="PCC">PCC</option>
            <option value="PDH">PDH</option>
            <option value="PLA">PLA</option>
            <option value="SQC">SQC</option>
            <option value="VPHN">VPHN</option>
            <option value="WHR">WHR</option>
          </select>
          <select name="category" class="custom-input" required>
            <option value="">Chọn hạng mục</option>
            <option value="nvxuatxac">Nhân viên xuất sắc</option>
            <option value="phongbanxuatxac">Phòng ban xuất sắc</option>
            <option value="duanxuatxac">Dự án xuất sắc</option>
          </select>
          <input name="month" type="number" min="1" max="12" class="custom-input" placeholder="Tháng" required>
          <input name="year" type="number" min="2020" max="2100" class="custom-input" placeholder="Năm" required>
          <input name="created_by" type="number" class="custom-input" placeholder="ID người tạo" required>
          <div class="custom-modal-actions">
            <button type="button" class="custom-btn custom-btn-cancel" onclick="closeRankingModal()">Đóng</button>
            <button type="submit" class="custom-btn custom-btn-save" id="rankingSaveBtn">Lưu BXH</button>
          </div>
        </form>
      </div>
    </div>
    <!-- Modal Thêm/Sửa thành viên BXH -->
    <div id="rankingMemberModal" class="custom-modal-overlay" style="display:none;">
      <div class="custom-modal user-modal">
        <button class="custom-modal-close" onclick="closeRankingMemberModal()" title="Đóng">
          <i class="fa-solid fa-xmark"></i>
        </button>
        <h2 class="custom-modal-title" id="rankingMemberModalTitle">Thêm thành viên BXH</h2>
        <form id="rankingMemberForm" autocomplete="off">
          <input name="user_id" type="number" class="custom-input" placeholder="ID user" required>
          <input name="position" type="number" class="custom-input" placeholder="Vị trí" required>
          <input name="description" type="text" class="custom-input" placeholder="Mô tả thành tích">
          <input name="votes" type="number" class="custom-input" placeholder="Số vote">
          <input name="avatar" type="text" class="custom-input" placeholder="Link avatar (nếu có)">
          <div class="custom-modal-actions">
            <button type="button" class="custom-btn custom-btn-cancel" onclick="closeRankingMemberModal()">Đóng</button>
            <button type="submit" class="custom-btn custom-btn-save" id="rankingMemberSaveBtn">Lưu thành viên</button>
          </div>
        </form>
      </div>
    </div>
    <script>
    // Modal BXH
    function openRankingModal(editData) {
      document.getElementById('rankingModal').style.display = 'flex';
      const form = document.getElementById('rankingForm');
      form.reset();
      form.removeAttribute('data-edit-id');
      document.getElementById('rankingModalTitle').textContent = editData ? 'Sửa BXH' : 'Thêm BXH';
      document.getElementById('rankingSaveBtn').textContent = editData ? 'Cập nhật' : 'Lưu BXH';
      if (editData) {
        for (const key in editData) {
          if (form[key]) form[key].value = editData[key];
        }
        form.setAttribute('data-edit-id', editData.id);
      }
    }
    function closeRankingModal() {
      document.getElementById('rankingModal').style.display = 'none';
      document.getElementById('rankingForm').reset();
      document.getElementById('rankingForm').removeAttribute('data-edit-id');
    }
    // Modal thành viên BXH
    function openRankingMemberModal(rankingId, editData) {
      document.getElementById('rankingMemberModal').style.display = 'flex';
      const form = document.getElementById('rankingMemberForm');
      form.reset();
      form.removeAttribute('data-edit-id');
      form.setAttribute('data-ranking-id', rankingId);
      document.getElementById('rankingMemberModalTitle').textContent = editData ? 'Sửa thành viên BXH' : 'Thêm thành viên BXH';
      document.getElementById('rankingMemberSaveBtn').textContent = editData ? 'Cập nhật' : 'Lưu thành viên';
      if (editData) {
        for (const key in editData) {
          if (form[key]) form[key].value = editData[key];
        }
        form.setAttribute('data-edit-id', editData.id);
      }
    }
    function closeRankingMemberModal() {
      document.getElementById('rankingMemberModal').style.display = 'none';
      document.getElementById('rankingMemberForm').reset();
      document.getElementById('rankingMemberForm').removeAttribute('data-edit-id');
    }
    // Sự kiện nút Thêm BXH
    const addRankingBtn = document.querySelector('.admin-title-row:nth-of-type(3) .add-btn');
    if (addRankingBtn) addRankingBtn.onclick = () => openRankingModal();
    // Sự kiện submit form BXH
    const rankingForm = document.getElementById('rankingForm');
    rankingForm.onsubmit = async function(e) {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(this).entries());
      const editId = this.getAttribute('data-edit-id');
      let url = '/api/rankings', method = 'POST';
      if (editId) {
        url = `/api/rankings/${editId}`;
        method = 'PUT';
      }
      try {
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success !== false) {
          showNotification(editId ? 'Cập nhật BXH thành công!' : 'Thêm BXH thành công!', 'success');
          closeRankingModal();
          loadRankings();
        } else {
          showNotification('Có lỗi xảy ra!', 'error');
        }
      } catch (err) {
        showNotification('Lỗi kết nối server!', 'error');
      }
    };
    // Sự kiện sửa BXH
    function attachRankingEditEvents() {
      document.querySelectorAll('#section-ranking .edit-btn').forEach(btn => {
        btn.onclick = function () {
          const id = this.closest('tr').dataset.id;
          const data = rankingData.find(r => r.id == id);
          openRankingModal(data);
        };
      });
    }
    // Gọi lại sau khi render bảng BXH
    const oldRenderRankingTable = renderRankingTable;
    renderRankingTable = function() {
      oldRenderRankingTable();
      attachRankingEditEvents();
    };
    // Sự kiện Thêm thành viên BXH
    function attachRankingDetailEvents() {
      // Nút Thêm thành viên (bạn có thể thêm nút này vào modal chi tiết nếu muốn)
      // Nút Sửa thành viên
      document.querySelectorAll('#rankingMembersTableBody .edit-btn').forEach(btn => {
        btn.onclick = function () {
          const id = this.closest('tr').dataset.id;
          const data = rankingMembersData.find(m => m.id == id);
          openRankingMemberModal(data.ranking_id, data);
        };
      });
    }
    const oldRenderRankingMembers = renderRankingMembers;
    renderRankingMembers = function() {
      oldRenderRankingMembers();
      attachRankingDetailEvents();
    };
    // Submit form thành viên BXH
    const rankingMemberForm = document.getElementById('rankingMemberForm');
    rankingMemberForm.onsubmit = async function(e) {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(this).entries());
      const rankingId = this.getAttribute('data-ranking-id');
      const editId = this.getAttribute('data-edit-id');
      let url = `/api/rankings/${rankingId}/members`, method = 'POST';
      if (editId) {
        url = `/api/ranking-members/${editId}`;
        method = 'PUT';
      }
      try {
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success !== false) {
          showNotification(editId ? 'Cập nhật thành viên thành công!' : 'Thêm thành viên thành công!', 'success');
          closeRankingMemberModal();
          showRankingDetailModal(rankingId);
        } else {
          showNotification('Có lỗi xảy ra!', 'error');
        }
      } catch (err) {
        showNotification('Lỗi kết nối server!', 'error');
      }
    };
    </script>
</body>
</html>